<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Forever Valentine</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Poppins:wght@300;400;600&family=Parisienne&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script type="module">
        import { Camera, Mesh, Plane, Program, Renderer, Texture, Transform } from 'https://cdn.skypack.dev/ogl';
        window.OGL = { Camera, Mesh, Plane, Program, Renderer, Texture, Transform };
    </script>
    
    <style>
        :root {
            --primary-pink: #ffafbd;
            --deep-rose: #ffc3a0;
            --heart-red: #ff4d6d;
            --blood-red: #8b0000;
            --dark-red: #4a0000;
            --glass-bg: rgba(255, 255, 255, 0.3);
            --card-bg: white;
            --text-color: #4a4a4a;
            --accent: #ff4d6d;
        }

        [data-theme="dark"] {
            --bg-gradient: linear-gradient(135deg, #2c3e50, #000000);
            --text-color: #f1f1f1;
            --glass-bg: rgba(0, 0, 0, 0.4);
            --card-bg: #1a1a1a;
        }

        body.accepted {
            background: linear-gradient(180deg, #8b0000, #4a0000) !important;
            color: white !important;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; transition: background 0.5s ease, color 0.5s ease; }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #ffafbd, #ffc3a0);
            background-attachment: fixed;
            overflow-x: hidden;
            text-align: center;
            color: var(--text-color);
        }

        .circular-gallery-container {
            width: 100%; height: 60vh; position: relative; cursor: grab; overflow: hidden; margin: 40px 0;
        }
        .circular-gallery-container:active { cursor: grabbing; }

        #music-player {
            position: fixed; bottom: 20px; left: 20px; z-index: 10000;
            background: var(--glass-bg); padding: 10px 15px; border-radius: 50px;
            display: none; align-items: center; gap: 10px; backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.3);
        }
        .pulse-heart { color: var(--heart-red); animation: pulse 1.2s infinite; font-size: 1.5rem; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.3); } 100% { transform: scale(1); } }

        .counter-container {
            margin-top: 20px; background: var(--glass-bg); padding: 15px 25px;
            border-radius: 20px; display: inline-block; backdrop-filter: blur(5px);
        }
        #days-count { font-size: 2.5rem; font-weight: 600; display: block; color: white; }
        .counter-label { font-size: 0.8rem; text-transform: uppercase; letter-spacing: 2px; color: white; }

        .theme-switch {
            position: fixed; top: 20px; right: 20px; z-index: 10000;
            background: var(--glass-bg); padding: 10px; border-radius: 50px;
            cursor: pointer; backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.2);
        }

        #lock-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(135deg, #ffafbd, #ffc3a0);
            z-index: 12000; display: flex; flex-direction: column; justify-content: center; align-items: center;
        }
        .lock-box { background: white; padding: 40px; border-radius: 30px; box-shadow: 0 20px 40px rgba(0,0,0,0.2); }
        #passInput { padding: 15px; border-radius: 15px; border: 2px solid var(--accent); font-size: 1.1rem; text-align: center; outline: none; margin-bottom: 20px; background: white; color: #333; }
        .unlock-btn { padding: 12px 40px; border-radius: 50px; border: none; background: var(--accent); color: white; font-weight: bold; cursor: pointer; }

        .love-map {
            display: flex; align-items: center; justify-content: center; gap: 20px;
            margin: 30px auto 10px auto; color: white; font-weight: 600;
            background: rgba(255,255,255,0.2); padding: 20px 40px; border-radius: 50px;
            width: fit-content; backdrop-filter: blur(5px);
        }
        .map-line { width: 100px; height: 2px; background: repeating-linear-gradient(to right, white 0, white 5px, transparent 5px, transparent 10px); position: relative; }
        .traveling-heart { position: absolute; top: -10px; left: 0; animation: travel 3s linear infinite; }
        @keyframes travel { 0% { left: 0; opacity: 0; } 50% { opacity: 1; } 100% { left: 100%; opacity: 0; } }

        section { min-height: 100vh; display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 20px; position: relative; }
        h1 { font-family: 'Dancing Script', cursive; font-size: clamp(3rem, 10vw, 5rem); color: var(--accent); }
        .accepted h1 { color: white; }

        .btn-container { position: relative; height: 150px; width: 100%; display: flex; justify-content: center; align-items: center; gap: 20px; }
        #yesBtn { padding: 20px 60px; font-size: 1.5rem; border-radius: 50px; border: none; background: var(--heart-red); color: white; cursor: pointer; box-shadow: 0 10px 20px rgba(255,77,109,0.4); z-index: 100; }
        #noBtn { padding: 10px 25px; border-radius: 50px; border: none; background: var(--glass-bg); cursor: pointer; color: var(--text-color); position: relative; z-index: 100; }

        .giant-rose { position: fixed; top: -100px; pointer-events: none; z-index: 999; animation: fall linear forwards; }
        @keyframes fall { to { transform: translateY(115vh) rotate(720deg); } }

        #success-msg { 
            display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); 
            background: white; padding: 30px; border-radius: 30px; z-index: 11000; 
            color: #444; width: 90%; max-width: 450px; box-shadow: 0 0 100px rgba(0,0,0,0.6); 
        }
        #secret-text { 
            display: none; font-family: 'Parisienne', cursive; font-size: 1.6rem; color: #5d4037; 
            border-bottom: 2px solid #f8d7da; margin-bottom: 15px; padding-bottom: 15px; 
        }
        .heart-bg { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: -1; }
    </style>
</head>
<body data-theme="light">

    <div id="music-player">
        <span class="pulse-heart">‚ù§Ô∏è</span>
        <span style="font-size: 0.8rem; font-weight: bold;">Playing Your Song...</span>
    </div>

    <div class="theme-switch" id="themeToggle">
        <span id="themeIcon">üåô</span>
    </div>

    <div id="lock-screen">
        <div class="lock-box">
            <h2 style="font-family: 'Dancing Script'; margin-bottom: 15px;">Unlock Your Heart ‚ù§Ô∏è</h2>
            <input type="password" id="passInput" placeholder="Enter Code...">
            <br>
            <button class="unlock-btn" onclick="checkPass()">Enter</button>
        </div>
    </div>

    <audio id="mySong" src="music.mp3" loop></audio>
    <div class="heart-bg" id="heartBg"></div>

    <section id="section-intro">
        <h1>Hi Love ‚ù§Ô∏è</h1>
        <div class="love-map">
            <span>Your City</span> 
            <div class="map-line"><div class="traveling-heart">‚ù§Ô∏è</div></div>
            <span>My City</span>
        </div>
        
        <div class="counter-container">
            <span id="days-count">000</span>
            <span class="counter-label">Days Together</span>
        </div>
        <p id="reasonText" style="margin-top: 30px; font-style: italic;">Every heartbeat is for you...</p>
    </section>

    <section id="section-circular-gallery">
        <h2 style="font-family: 'Dancing Script'; font-size: 2.5rem; margin-bottom: -20px;">Scroll our memories...</h2>
        <div id="gallery-root" class="circular-gallery-container"></div>
    </section>

    <section id="section-ask">
        <h1 id="questionTitle">Will you be my Valentine?</h1>
        <div class="btn-container">
            <button id="yesBtn">YES!</button>
            <button id="noBtn">No</button>
        </div>
        
        <div id="envelope-trigger" onclick="revealSecret()" style="margin-top: 40px; cursor: pointer; opacity: 0; pointer-events: none;">
            <span style="font-size: 5rem; filter: drop-shadow(0 0 15px white);">‚úâÔ∏è</span>
            <p style="color: white; font-weight: bold; font-size: 1.2rem;">Tap to read my letter</p>
        </div>
    </section>

    <div id="success-msg">
        <div id="secret-text">
            "My Darling,<br>You are the most beautiful part of my life. Distance is just a test of how far love can travel. Thank you for being mine."
        </div>
        <h2 id="success-title" style="font-family: 'Dancing Script'; font-size: 3rem; color: #8b0000;">I Knew It! ‚ù§Ô∏è</h2>
        <p id="success-sub">You've made me the happiest person alive.</p>
        <button onclick="document.getElementById('success-msg').style.display='none'" style="margin-top:15px; border:none; background:none; color:gray; cursor:pointer; font-weight:bold;">Close & Explore</button>
    </div>

    <script type="module">
        function lerp(p1, p2, t) { return p1 + (p2 - p1) * t; }
        
        class CircularGallery {
            constructor(container, options) {
                const { Camera, Mesh, Plane, Program, Renderer, Texture, Transform } = window.OGL;
                this.container = container;
                this.items = options.items || [];
                this.bend = options.bend || 3;
                this.scroll = { ease: 0.05, current: 0, target: 0, last: 0 };
                this.renderer = new Renderer({ alpha: true, antialias: true });
                this.gl = this.renderer.gl;
                this.container.appendChild(this.gl.canvas);
                this.camera = new Camera(this.gl);
                this.camera.position.z = 20;
                this.scene = new Transform();
                this.onResize();
                this.createGeometry();
                this.createMedias();
                this.addEvents();
                this.update();
            }
            createGeometry() { this.planeGeometry = new window.OGL.Plane(this.gl, { heightSegments: 50, widthSegments: 100 }); }
            createMedias() {
                const galleryItems = this.items.concat(this.items);
                this.medias = galleryItems.map((data, index) => {
                    const texture = new window.OGL.Texture(this.gl, { generateMipmaps: true });
                    const img = new Image();
                    img.crossOrigin = "anonymous";
                    img.src = data.image;
                    img.onload = () => { texture.image = img; program.uniforms.uImageSizes.value = [img.naturalWidth, img.naturalHeight]; };
                    const program = new window.OGL.Program(this.gl, {
                        vertex: `attribute vec3 position; attribute vec2 uv; uniform mat4 modelViewMatrix; uniform mat4 projectionMatrix; uniform float uTime; uniform float uSpeed; varying vec2 vUv; void main() { vUv = uv; vec3 p = position; p.z = (sin(p.x * 4.0 + uTime) * 1.5 + cos(p.y * 2.0 + uTime) * 1.5) * (0.1 + uSpeed * 0.5); gl_Position = projectionMatrix * modelViewMatrix * vec4(p, 1.0); }`,
                        fragment: `precision highp float; uniform vec2 uImageSizes; uniform vec2 uPlaneSizes; uniform sampler2D tMap; varying vec2 vUv; void main() { vec2 ratio = vec2(min((uPlaneSizes.x / uPlaneSizes.y) / (uImageSizes.x / uImageSizes.y), 1.0), min((uPlaneSizes.y / uPlaneSizes.x) / (uImageSizes.y / uImageSizes.x), 1.0)); vec2 uv = vec2(vUv.x * ratio.x + (1.0 - ratio.x) * 0.5, vUv.y * ratio.y + (1.0 - ratio.y) * 0.5); gl_FragColor = texture2D(tMap, uv); }`,
                        uniforms: { tMap: { value: texture }, uPlaneSizes: { value: [0, 0] }, uImageSizes: { value: [0, 0] }, uSpeed: { value: 0 }, uTime: { value: Math.random() * 100 } },
                        transparent: true
                    });
                    const plane = new window.OGL.Mesh(this.gl, { geometry: this.planeGeometry, program });
                    plane.setParent(this.scene);
                    return { plane, program, index, length: galleryItems.length, x: 0, extra: 0 };
                });
                this.layout();
            }
            layout() {
                this.medias.forEach((m, i) => {
                    const scale = this.screen.height / 1500;
                    m.plane.scale.y = (this.viewport.height * (700 * scale)) / this.screen.height;
                    m.plane.scale.x = (this.viewport.width * (500 * scale)) / this.screen.width;
                    m.program.uniforms.uPlaneSizes.value = [m.plane.scale.x, m.plane.scale.y];
                    m.width = m.plane.scale.x + 2;
                    m.widthTotal = m.width * m.length;
                    m.x = m.width * i;
                });
            }
            onResize() {
                this.screen = { width: this.container.clientWidth, height: this.container.clientHeight };
                this.renderer.setSize(this.screen.width, this.screen.height);
                this.camera.perspective({ aspect: this.gl.canvas.width / this.gl.canvas.height });
                const fov = (this.camera.fov * Math.PI) / 180;
                const h = 2 * Math.tan(fov / 2) * this.camera.position.z;
                this.viewport = { width: h * this.camera.aspect, height: h };
                if (this.medias) this.layout();
            }
            update() {
                this.scroll.current = lerp(this.scroll.current, this.scroll.target, this.scroll.ease);
                const direction = this.scroll.current > this.scroll.last ? 'right' : 'left';
                this.medias.forEach(m => {
                    m.plane.position.x = m.x - this.scroll.current - m.extra;
                    const x = m.plane.position.x;
                    const H = this.viewport.width / 2;
                    const B = Math.abs(this.bend);
                    const R = (H*H + B*B)/(2*B);
                    const effX = Math.min(Math.abs(x), H);
                    const arc = R - Math.sqrt(R*R - effX*effX);
                    m.plane.position.y = (this.bend > 0) ? -arc : arc;
                    m.plane.rotation.z = (this.bend > 0) ? -Math.sign(x) * Math.asin(effX/R) : Math.sign(x) * Math.asin(effX/R);
                    m.program.uniforms.uTime.value += 0.02;
                    m.program.uniforms.uSpeed.value = this.scroll.current - this.scroll.last;
                    if (direction === 'right' && x + m.plane.scale.x/2 < -this.viewport.width/2) m.extra -= m.widthTotal;
                    if (direction === 'left' && x - m.plane.scale.x/2 > this.viewport.width/2) m.extra += m.widthTotal;
                });
                this.renderer.render({ scene: this.scene, camera: this.camera });
                this.scroll.last = this.scroll.current;
                requestAnimationFrame(this.update.bind(this));
            }
            addEvents() {
                window.addEventListener('resize', this.onResize.bind(this));
                let isDown = false, startX = 0;
                this.container.addEventListener('mousedown', e => { isDown = true; startX = e.clientX; });
                window.addEventListener('mousemove', e => { if(!isDown) return; this.scroll.target += (startX - e.clientX) * 0.05; startX = e.clientX; });
                window.addEventListener('mouseup', () => isDown = false);
                this.container.addEventListener('wheel', e => this.scroll.target += e.deltaY * 0.05);
            }
        }

        // Initialize Site
        window.addEventListener('load', () => {
            const items = [
                { image: 'https://picsum.photos/seed/a/800/1000', text: 'Love' },
                { image: 'https://picsum.photos/seed/b/800/1000', text: 'US' },
                { image: 'https://picsum.photos/seed/c/800/1000', text: 'Always' },
                { image: 'https://picsum.photos/seed/d/800/1000', text: 'Forever' }
            ];
            new CircularGallery(document.getElementById('gallery-root'), { items, bend: 3 });
        });

        // Theme Toggle
        document.getElementById('themeToggle').addEventListener('click', () => {
            const body = document.body;
            const isLight = body.getAttribute('data-theme') === 'light';
            body.setAttribute('data-theme', isLight ? 'dark' : 'light');
            document.getElementById('themeIcon').innerText = isLight ? '‚òÄÔ∏è' : 'üåô';
        });

        // Love Counter
        const startDate = new Date("2023-05-20"); 
        function updateCounter() {
            const now = new Date();
            const diffDays = Math.ceil(Math.abs(now - startDate) / (1000 * 60 * 60 * 24));
            document.getElementById('days-count').innerText = diffDays;
        }
        updateCounter();

        // Passcheck & Audio Prime
        window.checkPass = function() {
            const pass = document.getElementById('passInput').value;
            if(pass === "1234") {
                const song = document.getElementById('mySong');
                song.play().then(() => { song.pause(); song.currentTime = 0; }).catch(() => {});
                document.getElementById('lock-screen').style.display = 'none';
            } else { alert("Try again, love! ‚ù§Ô∏è"); }
        }

        // Acceptance Logic
        let accepted = false;
        document.getElementById('yesBtn').addEventListener('click', () => {
            accepted = true;
            document.body.classList.add('accepted');
            document.getElementById('success-msg').style.display = 'block';
            document.getElementById('music-player').style.display = 'flex';
            document.getElementById('mySong').play();
            document.getElementById('envelope-trigger').style.opacity = '1';
            document.getElementById('envelope-trigger').style.pointerEvents = 'auto';
            document.getElementById('noBtn').style.display = 'none';
            
            setInterval(() => {
                const rose = document.createElement('div');
                rose.innerHTML = 'üåπ'; rose.className = 'giant-rose';
                rose.style.left = Math.random() * 100 + 'vw';
                rose.style.fontSize = (Math.random() * 50 + 30) + 'px';
                rose.style.animationDuration = (Math.random() * 2 + 2) + 's';
                document.body.appendChild(rose);
                setTimeout(() => rose.remove(), 4000);
            }, 80);
            
            confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });
        });

        // NO BUTTON WORKAROUND
        const noBtn = document.getElementById('noBtn');
        noBtn.addEventListener('mouseover', () => {
            if(accepted) return;
            noBtn.style.position = 'fixed';
            noBtn.style.left = Math.random() * (window.innerWidth - 150) + 'px';
            noBtn.style.top = Math.random() * (window.innerHeight - 50) + 'px';
        });

        window.revealSecret = function() {
            document.getElementById('secret-text').style.display = 'block';
            document.getElementById('success-msg').style.display = 'block';
        }

        // Floating Hearts
        setInterval(() => {
            const heart = document.createElement('div');
            heart.innerHTML = '‚ù§Ô∏è'; heart.style.position = 'fixed';
            heart.style.left = Math.random() * 100 + 'vw'; heart.style.top = '100vh';
            heart.style.opacity = Math.random(); heart.style.zIndex = '-1';
            heart.style.transition = 'transform 6s linear';
            document.getElementById('heartBg').appendChild(heart);
            setTimeout(() => heart.style.transform = 'translateY(-110vh)', 50);
            setTimeout(() => heart.remove(), 7000);
        }, 400);
    </script>
</body>
</html>